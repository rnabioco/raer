<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="raer">
<title>Identifying RNA editing sites in droplet single cell datasets • raer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Identifying RNA editing sites in droplet single cell datasets">
<meta property="og:description" content="raer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="rnabioco.github.io" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">raer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/raer.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/novel-sites.html">Identifying RNA editing sites using RNA and DNA sequencing data</a>
    <a class="dropdown-item" href="../articles/single-cell.html">Identifying RNA editing sites in droplet single cell datasets</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rnabioco/raer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Identifying RNA editing sites in droplet single cell datasets</h1>
                        <h4 data-toc-skip class="author">Kent
Riemondy</h4>
            <address class="author_afil">
      University of Colorado School of Medicine<br><h4 data-toc-skip class="date">2022-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnabioco/raer/blob/HEAD/vignettes/single-cell.Rmd" class="external-link"><code>vignettes/single-cell.Rmd</code></a></small>
      <div class="d-none name"><code>single-cell.Rmd</code></div>
    </address>
</div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rnabioco.github.io/raer">raer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: SingleCellExperiment</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: SummarizedExperiment</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: MatrixGenerics</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: matrixStats</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'MatrixGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,</span></span>
<span><span class="co">##     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,</span></span>
<span><span class="co">##     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,</span></span>
<span><span class="co">##     colMads, colMaxs, colMeans2, colMedians, colMins,</span></span>
<span><span class="co">##     colOrderStats, colProds, colQuantiles, colRanges, colRanks,</span></span>
<span><span class="co">##     colSdDiffs, colSds, colSums2, colTabulates, colVarDiffs,</span></span>
<span><span class="co">##     colVars, colWeightedMads, colWeightedMeans,</span></span>
<span><span class="co">##     colWeightedMedians, colWeightedSds, colWeightedVars, rowAlls,</span></span>
<span><span class="co">##     rowAnyNAs, rowAnys, rowAvgsPerColSet, rowCollapse, rowCounts,</span></span>
<span><span class="co">##     rowCummaxs, rowCummins, rowCumprods, rowCumsums, rowDiffs,</span></span>
<span><span class="co">##     rowIQRDiffs, rowIQRs, rowLogSumExps, rowMadDiffs, rowMads,</span></span>
<span><span class="co">##     rowMaxs, rowMeans2, rowMedians, rowMins, rowOrderStats,</span></span>
<span><span class="co">##     rowProds, rowQuantiles, rowRanges, rowRanks, rowSdDiffs,</span></span>
<span><span class="co">##     rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,</span></span>
<span><span class="co">##     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,</span></span>
<span><span class="co">##     rowWeightedSds, rowWeightedVars</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenomicRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: stats4</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BiocGenerics</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'BiocGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     IQR, mad, sd, var, xtabs</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">##     colnames, dirname, do.call, duplicated, eval, evalq, Filter,</span></span>
<span><span class="co">##     Find, get, grep, grepl, intersect, is.unsorted, lapply, Map,</span></span>
<span><span class="co">##     mapply, match, mget, order, paste, pmax, pmax.int, pmin,</span></span>
<span><span class="co">##     pmin.int, Position, rank, rbind, Reduce, rownames, sapply,</span></span>
<span><span class="co">##     setdiff, sort, table, tapply, union, unique, unsplit,</span></span>
<span><span class="co">##     which.max, which.min</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: S4Vectors</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'S4Vectors'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     expand.grid, I, unname</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: IRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenomeInfoDb</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: Biobase</span></span></code></pre>
<pre><code><span><span class="co">## Welcome to Bioconductor</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Vignettes contain introductory material; view with</span></span>
<span><span class="co">##     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">##     'citation("Biobase")', and for packages</span></span>
<span><span class="co">##     'citation("pkgname")'.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'Biobase'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:MatrixGenerics':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     rowMedians</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyMissing, rowMedians</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: scuttle</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ggplot2</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/GenomicFeatures" class="external-link">GenomicFeatures</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: AnnotationDbi</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rtracklayer</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="characterizing-rna-editing-sites-in-single-cell-data">Characterizing RNA editing sites in single cell data<a class="anchor" aria-label="anchor" href="#characterizing-rna-editing-sites-in-single-cell-data"></a>
</h2>
<p>This vignette will demonstrate how to use the <code>raer</code>
package to examine RNA editing in droplet-based single cell RNA-seq
data.</p>
<div class="section level3">
<h3 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h3>
<p>For this example analysis we will use a single cell dataset
containing mouse brain cells generated by <a href="link_to_dataset">10x
Genomics</a>. The single cell data was processed using the cellranger
pipeline. The BAM file contains a tag (<code>CB</code>) which indicates
the cell-barcode associated with each alignment, as well as a tag to
encoding information about which alignments are representative of a UMI
(<code>xf</code>).</p>
<p>To process the bam using <code>raer</code> we will conduct a few
preprocessing steps using command line tools (<code>samtools</code>).
First we will remove PCR duplicates, only keeping reads that are
representative of UMIs. As suggested by 10x genomics, we will filter to
keep reads that have a bitwise alignment flag set to
<code>xf:i:25</code>.</p>
<p><strong>If using bamfiles generated by cellranger prior to versions
v7.0.0, then you may want to reprocess the data with
<code>--include-introns</code>. Intron aligned reads were not considered
as potential UMIs, so would be excluded by filtering for
<code>xf:i:25</code>. The default behavior for version 7.0.0 will
include introns. </strong></p>
<p>After filtering for UMIs the bam will be sorted by the
<code>CB</code> tag. This sorting strategy will enable rapid extraction
of alignments from individual (or sets of) cell-barcodes. These steps
can be combined as follows:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-b</span> <span class="at">-d</span> <span class="st">"xf:25"</span>  possorted_genome_bam.bam<span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">samtools</span> sort <span class="at">-t</span> CB <span class="dt">\</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;</span> cbsorted_genome_bam.bam</span></code></pre></div>
<p><code>raer</code> contains functionality to build a simple index that
stores the file position for each cell-barcode, enabling rapid
extraction of alignments for defined cell-barcodes. The method is based
on an approach from <code>Jared Thompson</code> in the <code>bri</code>
commandline tool. The index file will have the <code>.bri</code> index
file name.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idx_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tag_index.html">build_tag_index</a></span><span class="op">(</span><span class="st">"cbsorted_genome_bam.bam"</span>, tag <span class="op">=</span> <span class="st">"CB"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="single-cell-editing-analysis">Single cell editing analysis<a class="anchor" aria-label="anchor" href="#single-cell-editing-analysis"></a>
</h3>
<p>For this vignette, we will use data from a human PBMC scRNA-seq
dataset from 10x Genomics.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_data.html">download_human_pbmc</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="va">fns</span></span></code></pre></div>
<pre><code><span><span class="co">## $bams</span></span>
<span><span class="co">##                   10k_PBMC_3p_nextgem_Chromium_X_intron_cbsorted_genome_rediportal_xf25_chr16.bam </span></span>
<span><span class="co">## "/tmp/RtmpkQ4tfk/10k_PBMC_3p_nextgem_Chromium_X_intron_cbsorted_genome_rediportal_xf25_chr16.bam" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fasta</span></span>
<span><span class="co">##                   hg38_chr16.fasta.bgz </span></span>
<span><span class="co">## "/tmp/RtmpkQ4tfk/hg38_chr16.fasta.bgz" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $edit_sites</span></span>
<span><span class="co">##                   rediportal_sites.bed.gz </span></span>
<span><span class="co">## "/tmp/RtmpkQ4tfk/rediportal_sites.bed.gz" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sce</span></span>
<span><span class="co">##                   sce.rds </span></span>
<span><span class="co">## "/tmp/RtmpkQ4tfk/sce.rds"</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bam_fn</span> <span class="op">&lt;-</span> <span class="va">fns</span><span class="op">$</span><span class="va">bams</span></span>
<span><span class="va">fa_fn</span> <span class="op">&lt;-</span>  <span class="va">fns</span><span class="op">$</span><span class="va">fasta</span></span>
<span><span class="va">bed_fn</span> <span class="op">&lt;-</span> <span class="va">fns</span><span class="op">$</span><span class="va">edit_sites</span></span></code></pre></div>
<p>We’ll first index the bam file using
<code>build_tag_index</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tag_index.html">build_tag_index</a></span><span class="op">(</span><span class="va">bam_fn</span>, tag <span class="op">=</span> <span class="st">"CB"</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpkQ4tfk/10k_PBMC_3p_nextgem_Chromium_X_intron_cbsorted_genome_rediportal_xf25_chr16.bam.bri"</span></span></code></pre>
<p>We can query the index to see the cell-barcodes are present in the
bam file using <code><a href="../reference/tag_index.html">show_tag_index()</a></code>, which will return a
data.frame containing each <code>tag</code> value and the number of
alignments associated with each tag.</p>
<p>For this vignette we will select cell-barcodes with at least x
reads,</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tag_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tag_index.html">show_tag_index</a></span><span class="op">(</span><span class="va">bam_fn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tag_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  tag n</span></span>
<span><span class="co">## 1 AAACCCAAGAAGCCAC-1 1</span></span>
<span><span class="co">## 2 AAACCCAAGAAGGATG-1 1</span></span>
<span><span class="co">## 3 AAACCCAAGACCATAA-1 2</span></span>
<span><span class="co">## 4 AAACCCAAGACGTCGA-1 1</span></span>
<span><span class="co">## 5 AAACCCAAGATACGAT-1 2</span></span>
<span><span class="co">## 6 AAACCCAAGATGTAGT-1 1</span></span></code></pre>
<p>Next we’ll load in a <code>SingleCellExperiment</code> with cell-type
annotations.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">fns</span><span class="op">$</span><span class="va">sce</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html" class="external-link">plotUMAP</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="st">"celltype"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single-cell_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Next we’ll select editing sites to query. For this analysis we will
use sites from the Rediportal database. To minimize processing time we
will first identify sites with read coverage.
<code><a href="../reference/filter_by_coverage.html">filter_by_coverage()</a></code> will examine read coverage across all
alignments to avoid examining and storing information about sites with
no or minimal coverage.</p>
<p>When analyzing single cell data we have the option to quantify
editing sites for each cell or we can quantify sites by pooling
alignments across similar cells, such as cells in the same cluster.</p>
<p><code>raer</code> provides a wrapper function,
<code><a href="../reference/sc_editing.html">sc_editing()</a></code>, which will extract alignments per cell (or
cluster) using <code><a href="../reference/tag_index.html">get_tag_bam()</a></code>, generate editing site counts
(<code><a href="../reference/get_pileup.html">get_pileup()</a></code>), then collect the site counts into a
SummarizedExperiment (<code><a href="../reference/create_se.html">create_se()</a></code>).</p>
<p>The <code>cell_barcodes</code> argument specifies which cell-barcodes
will be queried. If a character vector of cell-barcodes is supplied,
editing sites will be quantified per cell-barcode. Alternatively a list
containing cell-barcodes per cluster or group can be supplied, in which
case editing sites will be quantified by pooling alignments per
group.</p>
<p>Arguments for <code><a href="../reference/get_pileup.html">get_pileup()</a></code> can be passed to
<code><a href="../reference/sc_editing.html">sc_editing()</a></code>. Additionally, the editing site counts can be
stored as <code>sparseMatrices</code> to reduce memory usage by setting
<code>sparse = TRUE</code>. Lastly, processing time can be reduced by
operating in parallel across groups of cells (or clusters), by supplying
a BiocParallel backend to the <code>BPPARAM</code> argument
(e.g. <code>MultiCoreParam()</code>).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sc_editing.html">sc_editing</a></span><span class="op">(</span>bamfile <span class="op">=</span> <span class="va">bam_fn</span>,</span>
<span>                 fafile <span class="op">=</span> <span class="va">fa_fn</span>,</span>
<span>                 bedfile <span class="op">=</span> <span class="va">bed_fn</span>,</span>
<span>                 cell_barcodes <span class="op">=</span> <span class="va">cbs</span>,</span>
<span>                 assay_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nA"</span>, <span class="st">"nG"</span><span class="op">)</span>,</span>
<span>                 filterParam <span class="op">=</span> <span class="fu"><a href="../reference/get_pileup.html">FilterParam</a></span><span class="op">(</span>min_base_quality <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>                                           library_type <span class="op">=</span> <span class="st">"fr-second-strand"</span>,</span>
<span>                                           min_nucleotide_depth <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>                                           trim_5p <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>                                           trim_3p <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## beginning pileup</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 1 (cells 1-50)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 2 (cells 51-100)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 3 (cells 101-150)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 4 (cells 151-200)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 5 (cells 201-250)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 6 (cells 251-300)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 7 (cells 301-350)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 8 (cells 351-400)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 9 (cells 401-450)</span></span></code></pre>
<pre><code><span><span class="co">## working on: batch 10 (cells 451-500)</span></span></code></pre>
<pre><code><span><span class="co">## pileup completing, binding summarizedExperiments</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span></span></code></pre></div>
<pre><code><span><span class="co">## class: RangedSummarizedExperiment </span></span>
<span><span class="co">## dim: 58802 500 </span></span>
<span><span class="co">## metadata(0):</span></span>
<span><span class="co">## assays(2): nA nG</span></span>
<span><span class="co">## rownames(58802): chr16_83477_1 chr16_83486_1 ... chr16_90172755_1</span></span>
<span><span class="co">##   chr16_90172757_1</span></span>
<span><span class="co">## rowData names(1): Ref</span></span>
<span><span class="co">## colnames(500): TGTTTGTCAGTTAGGG-1 ATCTCTACAAGCTACT-1 ...</span></span>
<span><span class="co">##   GGGCGTTTCAGGACGA-1 CTATAGGAGATTGTGA-1</span></span>
<span><span class="co">## colData names(1): sample</span></span></code></pre>
<p>Next we’ll filter the pileups to find sites with at least 5 cells
with an editing event, and add the editing information to the
SingleCellExperiment as an <code><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp()</a></code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">se</span>, <span class="st">"nA"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">se</span>, <span class="st">"nG"</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_edit_frequency.html">calc_edit_frequency</a></span><span class="op">(</span><span class="va">se</span>, edit_from <span class="op">=</span> <span class="st">"A"</span>, edit_to <span class="op">=</span> <span class="st">"G"</span>, replace_na <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">small_se</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">se</span>, <span class="st">"nG"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce</span>, <span class="st">"edits"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">small_se</span></span></code></pre></div>
<p>With the editing sites added to the SingleCellExperiment we can use
plotting and other methods previously developed for single cell
analysis. Here we’ll visualize editing sites with the highest edited
read counts.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="st">"nG"</span><span class="op">)</span><span class="op">)</span> , decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html" class="external-link">plotUMAP</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="va">x</span>, by_exprs_values <span class="op">=</span> <span class="st">"nG"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-4.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-5.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-6.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-7.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-8.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[9]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-9.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[10]]</span></span></code></pre>
<p><img src="single-cell_files/figure-html/unnamed-chunk-9-10.png" width="700"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">$</span><span class="va">celltype</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotGroupedHeatmap.html" class="external-link">plotGroupedHeatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html" class="external-link">altExp</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, </span>
<span>            features <span class="op">=</span> <span class="va">to_plot</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span>, </span>
<span>            group <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>            exprs_values <span class="op">=</span> <span class="st">"nG"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single-cell_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Various tools in Bioconductor can be used to provide additional
annotation information about each RNA editing site. The
<code>VariantAnnotation</code> package provides powerful functionality
to annotate the location of each editing site, and provide information
about alterations in codons or splice site.</p>
<details style="margin-bottom:10px;"><summary>
Session info
</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 20.04.5 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] rtracklayer_1.57.0          GenomicFeatures_1.49.7     </span></span>
<span><span class="co">##  [3] AnnotationDbi_1.59.1        scater_1.25.7              </span></span>
<span><span class="co">##  [5] ggplot2_3.3.6               scuttle_1.7.4              </span></span>
<span><span class="co">##  [7] SingleCellExperiment_1.19.0 SummarizedExperiment_1.27.3</span></span>
<span><span class="co">##  [9] Biobase_2.57.1              GenomicRanges_1.49.1       </span></span>
<span><span class="co">## [11] GenomeInfoDb_1.33.7         IRanges_2.31.2             </span></span>
<span><span class="co">## [13] S4Vectors_0.35.4            BiocGenerics_0.43.4        </span></span>
<span><span class="co">## [15] MatrixGenerics_1.9.1        matrixStats_0.62.0         </span></span>
<span><span class="co">## [17] raer_0.99.0                 BiocStyle_2.25.0           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] ggbeeswarm_0.6.0          colorspace_2.0-3         </span></span>
<span><span class="co">##   [3] rjson_0.2.21              ellipsis_0.3.2           </span></span>
<span><span class="co">##   [5] rprojroot_2.0.3           XVector_0.37.1           </span></span>
<span><span class="co">##   [7] BiocNeighbors_1.15.1      fs_1.5.2                 </span></span>
<span><span class="co">##   [9] farver_2.1.1              ggrepel_0.9.1            </span></span>
<span><span class="co">##  [11] bit64_4.0.5               fansi_1.0.3              </span></span>
<span><span class="co">##  [13] xml2_1.3.3                codetools_0.2-18         </span></span>
<span><span class="co">##  [15] R.methodsS3_1.8.2         sparseMatrixStats_1.9.0  </span></span>
<span><span class="co">##  [17] cachem_1.0.6              knitr_1.40               </span></span>
<span><span class="co">##  [19] jsonlite_1.8.0            Rsamtools_2.13.4         </span></span>
<span><span class="co">##  [21] dbplyr_2.2.1              png_0.1-7                </span></span>
<span><span class="co">##  [23] R.oo_1.25.0               pheatmap_1.0.12          </span></span>
<span><span class="co">##  [25] BiocManager_1.30.18       compiler_4.2.1           </span></span>
<span><span class="co">##  [27] httr_1.4.4                assertthat_0.2.1         </span></span>
<span><span class="co">##  [29] Matrix_1.5-1              fastmap_1.1.0            </span></span>
<span><span class="co">##  [31] cli_3.4.1                 BiocSingular_1.13.1      </span></span>
<span><span class="co">##  [33] htmltools_0.5.3           prettyunits_1.1.1        </span></span>
<span><span class="co">##  [35] tools_4.2.1               rsvd_1.0.5               </span></span>
<span><span class="co">##  [37] gtable_0.3.1              glue_1.6.2               </span></span>
<span><span class="co">##  [39] GenomeInfoDbData_1.2.9    dplyr_1.0.10             </span></span>
<span><span class="co">##  [41] rappdirs_0.3.3            Rcpp_1.0.9               </span></span>
<span><span class="co">##  [43] jquerylib_0.1.4           pkgdown_2.0.6            </span></span>
<span><span class="co">##  [45] vctrs_0.4.2               Biostrings_2.65.6        </span></span>
<span><span class="co">##  [47] DelayedMatrixStats_1.19.1 xfun_0.33                </span></span>
<span><span class="co">##  [49] stringr_1.4.1             beachmat_2.13.4          </span></span>
<span><span class="co">##  [51] irlba_2.3.5               lifecycle_1.0.2          </span></span>
<span><span class="co">##  [53] restfulr_0.0.15           XML_3.99-0.10            </span></span>
<span><span class="co">##  [55] zlibbioc_1.43.0           scales_1.2.1             </span></span>
<span><span class="co">##  [57] BSgenome_1.65.2           ragg_1.2.3               </span></span>
<span><span class="co">##  [59] hms_1.1.2                 parallel_4.2.1           </span></span>
<span><span class="co">##  [61] RColorBrewer_1.1-3        yaml_2.3.5               </span></span>
<span><span class="co">##  [63] curl_4.3.2                gridExtra_2.3            </span></span>
<span><span class="co">##  [65] memoise_2.0.1             sass_0.4.2               </span></span>
<span><span class="co">##  [67] biomaRt_2.53.2            stringi_1.7.8            </span></span>
<span><span class="co">##  [69] RSQLite_2.2.17            highr_0.9                </span></span>
<span><span class="co">##  [71] BiocIO_1.7.1              desc_1.4.2               </span></span>
<span><span class="co">##  [73] ScaledMatrix_1.5.1        filelock_1.0.2           </span></span>
<span><span class="co">##  [75] BiocParallel_1.31.12      rlang_1.0.6              </span></span>
<span><span class="co">##  [77] pkgconfig_2.0.3           systemfonts_1.0.4        </span></span>
<span><span class="co">##  [79] bitops_1.0-7              evaluate_0.16            </span></span>
<span><span class="co">##  [81] lattice_0.20-45           purrr_0.3.4              </span></span>
<span><span class="co">##  [83] labeling_0.4.2            GenomicAlignments_1.33.1 </span></span>
<span><span class="co">##  [85] bit_4.0.4                 tidyselect_1.1.2         </span></span>
<span><span class="co">##  [87] magrittr_2.0.3            bookdown_0.29            </span></span>
<span><span class="co">##  [89] R6_2.5.1                  generics_0.1.3           </span></span>
<span><span class="co">##  [91] DelayedArray_0.23.2       DBI_1.1.3                </span></span>
<span><span class="co">##  [93] pillar_1.8.1              withr_2.5.0              </span></span>
<span><span class="co">##  [95] KEGGREST_1.37.3           RCurl_1.98-1.8           </span></span>
<span><span class="co">##  [97] tibble_3.1.8              crayon_1.5.2             </span></span>
<span><span class="co">##  [99] utf8_1.2.2                BiocFileCache_2.5.0      </span></span>
<span><span class="co">## [101] rmarkdown_2.16            viridis_0.6.2            </span></span>
<span><span class="co">## [103] progress_1.2.2            grid_4.2.1               </span></span>
<span><span class="co">## [105] data.table_1.14.2         blob_1.2.3               </span></span>
<span><span class="co">## [107] digest_0.6.29             R.utils_2.12.0           </span></span>
<span><span class="co">## [109] textshaping_0.3.6         munsell_0.5.0            </span></span>
<span><span class="co">## [111] viridisLite_0.4.1         beeswarm_0.4.0           </span></span>
<span><span class="co">## [113] vipor_0.4.5               bslib_0.4.0</span></span></code></pre>
</details>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>An R package developed by the <a href="https://medschool.cuanschutz.edu/rbi" class="external-link">RNA Bioscience Initiative</a></p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
